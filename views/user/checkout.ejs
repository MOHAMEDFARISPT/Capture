<!DOCTYPE html>
<html lang="en">
    
    <%- include('../userpartials/head')%>
    <%- include('../userpartials/naavhead')%>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" />
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"> -->
    

    <style>
         #appliedNotification {
            width: 100%;
        color: #4CAF50; /* White text color */
        padding: 10px; /* Padding around the message */
        border-radius: 5px; /* Rounded corners */
        text-align: center; /* Center the text */
    }
         .custom-radio {
            height: 20vh;
        border: 2px solid #ddd; /* Border color */
        border-radius: 8px; /* Border radius for a slightly rounded appearance */
        margin-bottom: 10px; /* Adjust as needed for spacing between items */
        padding: 10px; /* Padding for inner content */
        transition: border-color 0.3s ease; /* Smooth transition for border color on hover */
    }

    .custom-radio:hover {
        border-color: #007bff; /* Border color on hover */
    }

    .form-check-input {
        /* Add any specific styles for the radio input if needed */
    }

    .form-check-label {
        /* Add any specific styles for the label if needed */
    }
    /* Custom scrollbar styles */
    .custom-scrollbar {
        scrollbar-width: thin;
        scrollbar-color: #888 #f5f5f5;
    }

    .custom-scrollbar::-webkit-scrollbar {
        width: 2px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: #888;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
        background-color: #f5f5f5;
    }

    /* Set a maximum width for the left div */
    .max-width-container {
        max-width: 100%; /* Adjust this value as needed */
    }
        .custom-radio-container {
            display: flex;
            flex-direction: column;
        }
    
        .custom-radio {
            margin-bottom: 10px;
            border: 1px solid #c7a8a8;
            border-radius: 5px;
            cursor: pointer;
            transition: box-shadow 0.3s;
        }
    
        .custom-radio:hover {
            box-shadow: 0 0 10px rgba(5, 0, 0, 0.1);
        }
    
        .custom-radio input {
            margin-right: 5px;
        }
    </style>

<style>
    .col-lg-5 {
        margin-top: 20px; /* Adjust the top margin as needed */
    }

    .product-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

    .product-table th, .product-table td {
        padding: 8px;
        border: 1px solid #ddd;
        text-align: left;
    }

    .product-table img {
        display: block;
        margin: 0 auto;
    }
</style>
<style>
    .table tbody tr {
        line-height: 1; /* You can adjust this value to decrease or increase the row height */
    }
</style>


<!-- molla/checkout.html  22 Nov 2019 09:55:06 GMT -->

<body>
    <div class="page-wrapper">
       

        <main class="main">
        	<div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
        		<div class="container">
        			<h1 class="page-title">Checkout<span>Shop</span></h1>
        		</div><!-- End .container -->
        	</div><!-- End .page-header -->
            <nav aria-label="breadcrumb" class="breadcrumb-nav">
                <div class="container">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                        <li class="breadcrumb-item"><a href="#">Shop</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Checkout</li>
                    </ol>
                </div><!-- End .container -->
            </nav><!-- End .breadcrumb-nav -->

           
	                <div class="container">


                     
<!--    //////////////////////////////////////////////////////////-->>

                        <div class="container">
                            <div class="row justify-content-start" style="gap: 3rem;">
                                <!-- Left Side: Address Form or Card -->
                                <div class="col-lg-6 ms-2 max-width-container">
                                    <div class="card custom-scrollbar" style="width: 100%; margin-bottom: 0; max-height: 100vh; overflow-x: hidden; overflow-y: auto;">
                                        <div class="row">
                                            <div class="col-lg-12" style="height: 30%; margin-bottom: 0;">
                                                <div class="card card-dashboard" style="width: 100%; height: 100%; margin-bottom: 0;">
                                                    <div class="card-body">
                                                        <div class="form-group">
                                                            <div class="col-lg-5 mt-0 width:100vh">
                                                                <label class="font-weight-bold">Select Address:</label>
                                                                <!-- Add Address Button -->
                                                                <button class="btn btn-primary" onclick="toggleAddAddressForm()">Add Address</button>
                                                            
                                                                <!-- Add Address Form (initially hidden) -->
                                                                <div id="addAddressForm" style="display: none;">
                                                                    <!-- Form fields for adding address -->
                                                                    <form id="newAddressForm" method="post" action="/add-address-chkout">
                                                                        <div class="form-group" style="width: 500px;">
                                                                            <label for="fullname">Full Name:</label>
                                                                            <input type="text" class="form-control" name="fullname" id="fullname" placeholder="Enter Full Name" required>
                                                                            <span id="fullnameError" class="error" style="color: red;"></span>
                                                                        </div>
                                                                    
                                                                        <div class="form-group" style="width: 500px;">
                                                                            <label for="contact">Contact:</label>
                                                                            <input type="text" class="form-control" name="contact" id="contact" placeholder="Enter Contact" required>
                                                                            <span id="contactError" class="error" style="color: red;"></span>
                                                                        </div>
                                                                    
                                                                        <div class="form-group" style="width: 500px;">
                                                                            <label for="pincode">Pincode:</label>
                                                                            <input type="text" class="form-control" name="pincode" id="pincode" placeholder="Enter Pincode" required>
                                                                            <span id="pincodeError" class="error" style="color: red;"></span>
                                                                        </div>
                                                                    
                                                                        <div class="form-group" style="width: 500px;">
                                                                            <label for="state">State:</label>
                                                                            <input type="text" class="form-control" name="state" id="state" placeholder="Enter State" required>
                                                                            <span id="stateError" class="error" style="color: red;"></span>
                                                                        </div>
                                                                    
                                                                        <div class="form-group" style="width: 500px;">
                                                                            <label for="address">Address:</label>
                                                                            <textarea class="form-control" name="address" id="address" placeholder="Enter Address" rows="3" required></textarea>
                                                                            <span id="addressError" class="error" style="color: red;"></span>
                                                                        </div>
                                                                    
                                                                        <div class="form-group" style="width: 500px;">
                                                                            <label for="locality">Locality:</label>
                                                                            <input type="text" class="form-control" name="locality" id="locality" placeholder="Enter Locality" required>
                                                                            <span id="localityError" class="error" style="color: red;"></span>
                                                                        </div>
                                                                    
                                                                        <div class="form-group" style="width: 500px;">
                                                                            <label for="district">District:</label>
                                                                            <input type="text" class="form-control" id="district" name="district" placeholder="Enter District" required>
                                                                            <span id="districtError" class="error" style="color: red;"></span>
                                                                        </div>
                                                                    
                                                                        <!-- Add more fields as needed -->
                                                                    
                                                                        <button type="submit" class="btn btn-success" onclick="submitform()">Submit</button>
                                                                    </form>
                                                                </div>
                                                            
                                                                <div class="custom-radio-container" style="border: 5px groove white; width: 610px; height: 150px;"  >
                                                                    <% if (address != null && typeof address !== 'undefined' && address.addresses != null && address.addresses.length > 0) { %>
                                                                        <% address.addresses.forEach((item, index) => { %>
                                                                            <div class="custom-radio" style="width: 600px; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;">
                                                                                <div class="form-check">
                                                                                    <input
                                                                                        class="form-check-input"
                                                                                        type="radio"
                                                                                        id="address<%= index %>"
                                                                                        name="selectedAddress"
                                                                                        value="<%= item._id %>"
                                                                                    >
                                                                                    <label class="form-check-label" for="address<%= index %>" style="font-weight: bold;">
                                                                                        <div>
                                                                                            <a href="/edit-address-chekout/<%= item._id %>" title="Please click to edit">
                                                                                                Edit <i class="icon-edit"></i>
                                                                                            </a>
                                                                                        </div>
                                                                                        
                                                                                        
                                                                                       
                                                                                           
                                                                                        <%= item.fullname %> <br>
                                                                                        <%= item.address %> <br>
                                                                                        <%= item.city %> <%= item.state %> <%= item.pincode %>
                                                                                        <!-- Add more fields as needed -->
                                                                                    </label>
                                                                                </div>
                                                                            </div>
                                                                        <% }); %>
                                                                    <% } %>
                                                                </div>
                                                                
                                                            </div>
                                                            
                                                        </div>
                                                    </div><!-- End .card-body -->
                                                </div><!-- End .card-dashboard -->
                                            </div><!-- End .col-lg-12 -->
                                        </div>
                                    </div>
                                </div>
                        
                                <!-- Right Side: Order Details Card -->
                                <div class="col-lg-5 mt-0" style="background-color: rgb(243, 243, 236);">
                                    <div class="summary" style="background-color: rgb(255, 255, 255);">
                                        <h4 id="applyCouponLink" style="cursor: pointer; color: blue;" title="Plase Click to Apply Coupon">Apply Coupon</h4>
                                      
                                        <h3 class="summary-title">Your Order</h3>
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th scope="col" style="padding: 10px;"></th>
                                                    <th scope="col" style="color: black; padding: 14px;"></th>
                                                    <th scope="col" style="color: black; padding: 14px;"></th>
                                                    <th scope="col" style="color: black; padding: 14px;">Quantity</th>
                                                    <th scope="col" style="color: black; padding: 16px;">Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% let subtotal = 0; %>
                                                <% userCart.products.forEach(product => { %>
                                                    <% if (product.isSelected) { %>
                                                        <tr>
                                                            <td scope="row"><img src="<%= product.product.productImage[0] %>" alt="Product Image" style="width: 80px; height: auto;"></td>
                                                            <td style="padding: 14px;"><%= product.product.productname %></td>
                                                            <td style="padding: 14px;">₹<%= product.product.price.toFixed(2) %></td>
                                                            <td style="padding: 35px;"><%= product.quantity %></td>
                                                            <td style="padding: 14px;">₹<%= product.quantity * product.product.price.toFixed(2) %></td>
                                                        </tr>
                                                        <% subtotal += product.quantity * product.product.price; %>
                                                    <% } %>
                                                <% }); %>
                                            
                                                <!-- Display Subtotal -->
                                                <tr>
                                                    <td style="text-align: right;" >Subtotal :</td>
                                                    <td colspan="3"></td>
                                                    <td>₹<%= subtotal.toFixed(2) %></td>
                                                </tr>
                                            
                                                <!-- Display Discount on Coupon -->
                                                <% if (userCart.couponDetails.appliedCoupon) { %>
                                                    <tr>
                                                        <td colspan="2" style="text-align: start; color: #c02217;">Discount Applied :</td>
                                                        <td colspan="2" ></td>
                                                        <td style="color: #c02217;">-₹<%= userCart.couponDetails.discountedAmount.toFixed(2) %></td>
                                                    </tr>
                                                <% } %>
                                            
                                                <!-- Display the Grand Total in a separate row -->
                                                <tr>
                                                    <% if (userCart.couponDetails.appliedCoupon) { %>
                                                        <td colspan="4" style="text-align: end; color: #4CAF50;">
                                                            (Coupon Applied)
                                                            <button id="removeCouponButton" onclick="removeCoupon()" data-toggle="tooltip" data-placement="top" title="Remove Coupon">
                                                                <i class="fas fa-times-circle" style="color: red;"></i>
                                                            </button>
                                                            <script>
                                                                $('#removeCouponButton').tooltip();
                                                            </script>
                                                        </td>
                                                        <td style="padding: 10px;"><strong>Total: ₹ <span id="OrdertotalAmount"><%= userCart.totalamount.toFixed(2) %></span></strong></td>
                                                    <% } else { %>
                                                        <td colspan="4"></td>
                                                        <td style="padding: 10px;"><strong>Total: ₹ <span id="OrdertotalAmount"><%= userCart.totalamount.toFixed(2) %></span></strong></td>
                                                    <% } %>
                                                </tr>
                                            </tbody>
                                            
                                        </table>
                        
                                     
                        
                                        <h5 style="color: blue;">Select A Payment Method</h5>

                                        <!-- 
                                                                                <div class="payment-option">
                                                                                    <input type="radio" id="payment-direct" name="payment-method" value="direct">
                                                                                    <label for="payment-direct">Direct bank transfer</label>
                                                                                   
                                                                                </div> -->
                                                                                
                                                                                
                                                                                <div class="payment-option">
                                                                                    <input type="radio" id="payment-cod" name="payment-method" value="cod" onclick="selectPayment('cod')">
                                                                                    <label for="payment-cod">Cash on delivery</label>
                                                                                </div>

                                                                                <div class="payment-option">
                                                                                    <input type="radio" id="payment-cod" name="payment-method" value="Razorpay" onclick="selectPayment('razorpay')">
                                                                                    <label for="payment-cod">Razorpay</label>
                                                                                </div>
                                                                

                                                                                
                                                                                <div class="payment-option">
                                                                                    <input type="radio" id="payment-check" name="payment-method" value="Wallet" onclick="selectPayment('Wallet')">
                                                                                    <label for="payment-check">Wallet</label>
                                                                                    
                                                                                </div>
                                                                                <!-- <div class="payment-option">
                                                                                    <input type="radio" id="payment-direct" name="payment-method" value="direct">
                                                                                    <label for="payment-direct">Direct bank transfer</label>
                                                                                    
                                                                                </div> -->
                                                                                
                                                                                <!-- <div class="payment-option">
                                                                                    <input type="radio" id="payment-paypal" name="payment-method" value="paypal">
                                                                                    <label for="payment-paypal">PayPal</label>
                                                                                    
                                                                                </div>
                                                                                
                                                                                <div class="payment-option">
                                                                                    <input type="radio" id="payment-credit-card" name="payment-method" value="credit-card">
                                                                                    <label for="payment-credit-card">Credit Card (Stripe)</label>
                                                                                    
                                                                                </div>
                                                                                 -->
                                                                                
                        
                                        <button type="submit" class="btn btn-outline-primary-2 btn-order btn-block" onclick="placeOrder()">
                                            <span class="btn-text">Place Order</span>
                                            <span class="btn-hover-text">Proceed to Checkout</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        
                        
                        
                        <div class="modal fade" id="couponModal" tabindex="-1" role="dialog" aria-labelledby="couponModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="couponModalLabel">Enter Coupon Code</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body p-3">
                                        <!-- Input box for entering coupon code -->
                                        <div class="form-group">
                                           
                                            <input type="text" class="form-control" id="couponCode" placeholder="Enter coupon code Here">
                                        </div>
                                        <!-- Text check below the input box -->
                                        <small id="couponCodeError" class="text-danger"></small>
                                        <!-- Add more content as needed -->

                                        <% coupon.forEach(function(coupon) { %>
                                            <% if (coupon.islisted) { %>
                                                <div class="card mb-3">
                                                    <div class="card-body" style="display: flex; justify-content: space-around;  padding: 20px 0px 20px 20px;">
                                                        <div>
                                                            <h5 class="card-title"><%= coupon.couponcode %></h5>
                                                            <p class="card-text"><%= coupon.description %></p>
                                                            <p class="card-text"><strong>Discount Percentage:</strong> <%= coupon.discount_percentage %>%</p>
                                                            <p class="card-text"><strong>Minimum Amount:</strong> ₹<%= coupon.min_amount %> </p>
                                                        </div>
                                                        <div>
                                                            <button onclick="applyCoupon('<%= coupon.id %>')" class="btn btn-success">Apply</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            <% } %>
                                        <% }); %>
                                        
                                    </div>
                                    <div class="modal-footer">
                                        <div>
                                        <p id="appliedNotification"> </p>
                                    </div>
                                        <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> -->
                                        <!-- <button type="button" class="btn btn-primary" onclick="applyCoupon()">Apply Coupon</button> -->
                                    </div>
                                </div>
                            </div>
                        </div>                  
                          
                          
                          


            			<!-- <div class="checkout-discount">
            				<form action="#">
        						<input type="text" class="form-control" required id="checkout-discount-input">
            					<label for="checkout-discount-input" class="text-truncate">Have a coupon? <span>Click here to enter your code</span></label>
            				</form>
            			</div> -->


            			<!-- <form action="#">
		                	<div class="row">
		                		<div class="col-lg-9">
		                			<h2 class="checkout-title">Billing Details</h2>
		                				<div class="row">
		                					<div class="col-sm-6">
		                						<label>First Name *</label>
		                						<input type="text" class="form-control" required>
		                					</div>

		                					<div class="col-sm-6">
		                						<label>Last Name *</label>
		                						<input type="text" class="form-control" required>
		                					</div>
		                				</div>

	            						<label>Company Name (Optional)</label>
	            						<input type="text" class="form-control">

	            						<label>Country *</label>
	            						<input type="text" class="form-control" required>

	            						<label>Street address *</label>
	            						<input type="text" class="form-control" placeholder="House number and Street name" required>
	            						<input type="text" class="form-control" placeholder="Appartments, suite, unit etc ..." required>

	            						<div class="row">
		                					<div class="col-sm-6">
		                						<label>Town / City *</label>
		                						<input type="text" class="form-control" required>
		                					</div>
		                					<div class="col-sm-6">
		                						<label>State / County *</label>
		                						<input type="text" class="form-control" required>
		                					</div>
		                				</div>

		                				<div class="row">
		                					<div class="col-sm-6">
		                						<label>Postcode / ZIP *</label>
		                						<input type="text" class="form-control" required>
		                					</div>

		                					<div class="col-sm-6">
		                						<label>Phone *</label>
		                						<input type="tel" class="form-control" required>
		                					</div>
		                				</div>

	                					<label>Email address *</label>
	        							<input type="email" class="form-control" required>

	        							<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input" id="checkout-create-acc">
											<label class="custom-control-label" for="checkout-create-acc">Create an account?</label>
										</div>

										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input" id="checkout-diff-address">
											<label class="custom-control-label" for="checkout-diff-address">Ship to a different address?</label>
										</div>

	                					<label>Order notes (optional)</label>
	        							<textarea class="form-control" cols="30" rows="4" placeholder="Notes about your order, e.g. special notes for delivery"></textarea>
		                		</div>
		                		
		                	</div>
            			</form> -->
	                <!-- </div>
                </div>
            </div>
        </main> -->

        <aside class="col-lg-3"> 
           
        </aside>







        <footer class="footer">
        

	        <div class="footer-bottom">
	        	<div class="container">
	        		<p class="footer-copyright">Copyright © 2023 sneakpeakhub Store. All Rights Reserved.</p><!-- End .footer-copyright -->
	        		<figure class="footer-payments">
	        			<img src="assets/images/payments.png" alt="Payment methods" width="272" height="20">
	        		</figure><!-- End .footer-payments -->
	        	</div><!-- End .container -->
	        </div><!-- End .footer-bottom -->
        </footer><!-- End .footer -->
        <div style="width: 100px;">

        </div>
    </div><!-- End .page-wrapper -->
    <button id="scroll-top" title="Back to Top"><i class="icon-arrow-up"></i></button>

    <!-- Mobile Menu -->
    <div class="mobile-menu-overlay"></div><!-- End .mobil-menu-overlay -->

    <div class="mobile-menu-container">
        <div class="mobile-menu-wrapper">
            <span class="mobile-menu-close"><i class="icon-close"></i></span>

            <form action="#" method="get" class="mobile-search">
                <label for="mobile-search" class="sr-only">Search</label>
                <input type="search" class="form-control" name="mobile-search" id="mobile-search" placeholder="Search in..." required>
                <button class="btn btn-primary" type="submit"><i class="icon-search"></i></button>
            </form>
            
            <nav class="mobile-nav">
                <ul class="mobile-menu">
                    <li class="active">
                        <a href="index.html">Home</a>

                       
                    </li>
                    <li>
                        <a href="category.html">Shop</a>
                      
                    </li>
                    
                    
                  
                    
                </ul>
            </nav><!-- End .mobile-nav -->

           
        </div><!-- End .mobile-menu-wrapper -->
    </div><!-- End .mobile-menu-container -->

   

    <!-- Plugins JS File -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/jquery.hoverIntent.min.js"></script>
    <script src="assets/js/jquery.waypoints.min.js"></script>
    <script src="assets/js/superfish.min.js"></script>
    <script src="assets/js/owl.carousel.min.js"></script>
    <!-- Main JS File -->
    <script src="assets/js/main.js"></script>
<!-- Include jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Include Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
   
    $(function () {
        $('[data-toggle="tooltip"]').tooltip();
    });
</script>


    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    // Add an event listener to the button inside the form
    document.getElementById('hideCollapseButton').addEventListener('click', function() {
        // Hide the collapse
        $('#collapseOne').collapse('hide');
    });
</script>

<!-- Include SweetAlert library -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>


<script>
let payment = '';

function selectPayment(value) {
   

    payment = value;
}

async function placeOrder() {
    const selectedAddressId = document.querySelector('input[name="selectedAddress"]:checked')?.value;

    if (!selectedAddressId) {
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Please select an address',
        });
        return;
    }

    const selectedPaymentMethod = payment;
   

    if (!selectedPaymentMethod) {
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Please select a payment method',
        });
        return;
    }

    const confirmResult = await Swal.fire({
        icon: 'question',
        title: 'Confirm Order',
        text: 'Are you sure you want to place the order?',
        showCancelButton: true,
        confirmButtonText: 'Yes, Place Order',
        cancelButtonText: 'Cancel',
    });

    if (confirmResult.isConfirmed) {
        try {
            const response = await fetch('/place-order', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ selectedAddressId, selectedPaymentMethod }),
            });

            console.log('Complete Response:', response);

            const responseText = await response.text();
            console.log('Response Text:', responseText);

            let responseData;
            try {
                responseData = JSON.parse(responseText);
                console.log('Parsed Response JSON:', responseData);
            } catch (jsonError) {
                console.error('Error parsing JSON:', jsonError);
            }
console.log("responseDatassssssss",responseData)
            if (response.ok) {
                if (selectedPaymentMethod === 'cod') {
                    Swal.fire({
                        icon: 'success',
                        title: 'Order Placed!',
                        text: 'Your order has been placed successfully.',
                        showCancelButton: true,
                        confirmButtonText: 'OK',
                    }).then((result) => {
                        window.location.href = `/success/${responseData.order._id}`;
                    });
                } else if (selectedPaymentMethod === 'razorpay') {
                    razorpayFunction(responseData);

                }else if(selectedPaymentMethod === 'Wallet'){
                    Swal.fire({
                        icon: 'success',
                        title: 'Order Placed!',
                        text: 'Your order has been placed successfully.',
                        showCancelButton: true,
                        confirmButtonText: 'OK',
                    }).then((result) => {
                        window.location.href = `/success/${responseData.order._id}`;
                    });






                } 
                else {
                    console.log('Unknown payment method');
                }
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'There was an error placing your order. Please try again later.',
                });
            }
        } catch (error) {
            console.error('Error placing order:', error);
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'There was an error placing your order. Please try again later.',
            });
        }
    }
}

function razorpayFunction(res) {
    console.log(res);

    if (!res || !res.orderId || !res.key_id) {
        console.error('Invalid response format');
        Swal.fire({
            icon: 'error',
            title: 'Error',
            text: 'Invalid response format. Please try again later.',
        });
        return;
    }

    const options = {
        key: res.key_id,
        amount: res.order?.amount || 0, // Ensure 'amount' is defined
        currency: res.order?.currency || 'INR', // Provide a default currency if not defined
        name: "Sneak Peack Heaven",
        description: "Shoes",
        image: 'LOGO',
        order_id: res.orderId,
        handler: async function (response) {
            console.log(response);

            const data = {
                orderCreationId: res.orderId,
                razorpayPaymentId: response.razorpay_payment_id,
                razorpayOrderId: response.razorpay_order_id,
                razorpaySignature: response.razorpay_signature,
            };

            console.log('/////////////////////////////////////////////////');
            console.log(data.orderCreationId);

            try {
                const verifyResponse = await fetch(`/rzrpay-verify,${data.orderCreationId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        data: {
                            orderCreationId: res.orderId,
                            razorpayPaymentId: response.razorpay_payment_id,
                            razorpayOrderId: response.razorpay_order_id,
                            razorpaySignature: response.razorpay_signature,
                        }
                    }),
                });

                const result = await verifyResponse.json();
                console.log("resultttt",result)

                if (result.msg === 'success') {

                   
                    Swal.fire({
                        title: "Order placed !!",
                        text: "Your Order has been confirmed.",
                        icon: "success",
                    }).then(() => {
                        window.location.href = `/success/${responseData.order._id}`;
                    });
                } else {
                    alert("Some verification issue caused. Please try again after some time.");
                }
            } catch (error) {
                console.error("Error during verification:", error);
                alert(`An error occurred during verification: ${error.message}`);
            }
        },
        prefill: {
            name: "Soumya Dey",
            email: "SoumyaDey@example.com",
            contact: "9999999999",
        },
        notes: {
            address: "Soumya Dey Corporate Office",
        },
        theme: {
            color: "#000",
        },
    };

    const rzp = new Razorpay(options);
    rzp.open();
}

</script>


<script>
    async function toggleAddAddressForm() {
        var addAddressForm = document.getElementById('addAddressForm');
        addAddressForm.style.display = addAddressForm.style.display === 'none' ? 'block' : 'none';
    }

//    async function submitform() {
//         alert("//////")
//     // Access form fields
//     var fullname = document.getElementById('fullname').value;
//     var contact = document.getElementById('contact').value;
//     var address = document.getElementById('address').value;
//     var locality = document.getElementById('locality').value;
//     var district = document.getElementById('district').value;
//     var state = document.getElementById('state').value;
//     var pincode = document.getElementById('pincode').value;

//     // Create FormData object to hold the form data
//     var formData = new FormData();
//     formData.append('fullname', fullname);
//     formData.append('contact', contact);
//     formData.append('address', address);
//     formData.append('locality', locality);
//     formData.append('district', district);
//     formData.append('state', state);
//     formData.append('pincode', pincode);
// console.log("formData",formData)
// alert(formData)
//     // Make a POST request to your backend endpoint
//     fetch('/add-address-chkout', {
        
//     method: 'POST',
    
//     body: formData
// })
// .then(response => response.json())
// .then(data => {
//     window.location.reload()
//        console.log('Response from backend:', data);
// })
// .catch(error => {
//     console.error('Error:', error);
// });

// }


</script>





<script>
    function submitForm() {
        // Get form elements
        var fullname = document.getElementById('fullname').value;
        var contact = document.getElementById('contact').value;
        var pincode = document.getElementById('pincode').value;
        var state = document.getElementById('state').value;
        var address = document.getElementById('address').value;
        var locality = document.getElementById('locality').value;
        var district = document.getElementById('district').value;

        // Get error elements
        var fullnameError = document.getElementById('fullnameError');
        var contactError = document.getElementById('contactError');
        var pincodeError = document.getElementById('pincodeError');
        var stateError = document.getElementById('stateError');
        var addressError = document.getElementById('addressError');
        var localityError = document.getElementById('localityError');
        var districtError = document.getElementById('districtError');

        // Reset error messages
        fullnameError.innerHTML = '';
        contactError.innerHTML = '';
        pincodeError.innerHTML = '';
        stateError.innerHTML = '';
        addressError.innerHTML = '';
        localityError.innerHTML = '';
        districtError.innerHTML = '';

        // Validation for Full Name
        if (!fullname || /^\s*$/.test(fullname) || !isNaN(fullname)) {
            fullnameError.innerHTML = 'Please enter a valid Full Name';
            return;
        }

        // Validation for Contact
        if (!contact || isNaN(contact) || contact.length !== 10) {
            contactError.innerHTML = 'Please enter a valid Contact number';
            return;
        }

        // Validation for Pincode
        if (!pincode || isNaN(pincode) || pincode.length !== 6) {
            pincodeError.innerHTML = 'Please enter a valid Pincode';
            return;
        }

        // Validation for District
        if (!district || /^\s*$/.test(district) || !isNaN(district)) {
            districtError.innerHTML = 'Please enter a valid District';
            return;
        }

        // Simple validation for other fields (non-empty check)
        if (!fullname || !contact || !pincode || !state || !address || !locality || !district) {
            alert('Please fill in all fields');
            return;
        }

        // Additional validation logic can be added based on your requirements

        // If all validations pass, submit the form
        document.getElementById('newAddressForm').submit();
    }
</script>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Your custom script -->
<script>
    document.getElementById('applyCouponLink').addEventListener('click', function () {
        $('#couponModal').modal('show');
    });
</script>







<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>


<script>
    async function applyCoupon(couponId) {
       
        
        // Your backend API endpoint with parameters in the route
        const apiUrl = `/couponapply/${couponId}`;

        try {
            // Make a fetch request
            const response = await fetch(apiUrl, {
                method: 'POST', // Adjust the method accordingly
                headers: {
                    'Content-Type': 'application/json',
                    // Add any additional headers if needed
                },
                // No need to include a request body for a POST request in this case
            });

            if (!response.ok) {
                throw new Error(`Network response was not ok (${response.status} ${response.statusText})`);
            }

            const data = await response.json();
            console.log(data);

            // Handle the response from the server
            if (data.success === true) {
                Swal.fire({
                    icon: 'success',
                    title: 'Coupon Applied Successfully',
                    text: `Coupon applied successfully. Discounted Total: ${data.discountedTotal}`,
                    timer: 5000, // Set the timer for 5 seconds (adjust as needed)
                    showConfirmButton: true,
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Reload the page after the user clicks "OK"
                        window.location.reload();
                    }
                });

                document.getElementById('OrdertotalAmount').textContent = data.discountedTotal;
                document.getElementById('appliedNotification').textContent = `Congratulations! You saved ${data.discountedAmount} in this Order`;
            } else {
                Swal.fire({
                    icon: 'error', // Fix: Use lowercase 'error'
                    title: data.message,
                });
            }
        } catch (error) {
            // Handle errors
            console.error('Error:', error.message);

            // Use SweetAlert to show an error alert
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'An error occurred while applying the coupon. Please try again later.',
            });
        }
    }
</script>




<script>
       async function removeCoupon() {
   
                try {
                    const userId = '<%= userCart.user %>'; // Replace with the actual user ID
                    const response = await fetch(`/cart/remove-coupon/${userId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    });

                    if (response.ok) {
                        const data = await response.json();
                        window.location.reload()
                        console.log(data); // Handle the response from the server
                        // Optionally, update the UI based on the server response
                    } else {
                        console.error('Error:', response.status);
                    }
                } catch (error) {
                    console.error('Error:', error);
                }
            }
</script>
    
</body>


<!-- molla/checkout.html  22 Nov 2019 09:55:06 GMT -->
</html>