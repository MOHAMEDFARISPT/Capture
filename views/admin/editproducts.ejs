
<%- include('../adminpartials/header')%>
<%- include('../adminpartials/slidebar')%>
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

<div class="page-body ">

    <!-- New Product Add Start -->
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="row">
                    <div class="col-sm-8 m-auto">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-header-2">
                                    <h5>Edit Products Detailes</h5>
                                </div>

                                <div class='d-flex gap-2'>
                                    <% product.productImage.forEach((item,i) => { %>
                                        <div class="image-wrapper">
                                            <img src="<%= item%>" width="100" height="100px">
                                            <button class="remove-button" onclick="removeImage('<%= i%>','<%= product._id %>')">X</button>

                                        </div>
                                        <% }); %>
                                        </div>
                                       
                               
                                
                                <form class="theme-form theme-form-2 mega-form" action="/admin/editpost/<%= product._id %>" method="post" enctype="multipart/form-data" onsubmit="return validateProductForm()">
                                    <!-- Product Image -->
                                    <div class="mb-4 row align-items-center mt-5 mb-5">
                                        <label class="col-sm-3 col-form-label form-label-title">Product Image</label>
                                        <div class="col-sm-9">
                                            <input class="form-control form-choose" type="file" name="productImage" multiple accept=".jpg, .jpeg, .png, .webp">
                                            <span id="productImageError" class="error-message text-danger"></span>
                                        </div>
                                    </div>
                                    

                                  
                                
                                    <!-- Product Name -->
                                    <div class="mb-4 row align-items-center">
                                        <label class="form-label-title col-sm-3 mb-5">Product Name</label>
                                        <div class="col-sm-9">
                                            <input class="form-control" type="text" name="productname" placeholder="" value="<%= product.productname %>">
                                            <span id="productNameError" class="error-text  text-danger"></span>
                                        </div>
                                    </div>
                                
                                    <!-- Product Description -->
                                    <div class="mb-4 row align-items-center">
                                        <label class="form-label-title col-sm-3 mb-5">Product description</label>
                                        <div class="col-sm-9">
                                            <input class="form-control" type="text" name="description" placeholder="" value="<%= product.description %>">
                                            <span id="descriptionError" class="error-text  text-danger"></span>
                                        </div>
                                    </div>
                                
                                    <!-- Category -->
                                    <div class="mb-4 row align-items-center">
                                        <label class="form-label-title col-sm-3 mb-0">Category</label>
                                        <div class="col-sm-9">
                                            <select name="category" style="width: 100%;">
                                                <option value="">Select a Category</option>
                                                <% category.forEach((item) => { %>
                                                    <option value="<%= item._id %>" <%= item._id.toString() === product.category.toString() ? 'selected' : '' %>>
                                                        <%= item.categoryname %>
                                                    </option>
                                                <% }); %>
                                            </select>
                                            <span id="categoryError" class="error-text  text-danger"></span>
                                        </div>
                                    </div>
                                
                                    <!-- Quantity -->
                                    <div class="mb-4 row align-items-center">
                                        <label class="form-label-title col-sm-3 mb-0">Quantity</label>
                                        <div class="col-sm-9">
                                            <input class="form-control" type="text" name="quantity" placeholder="" value="<%= product.quantity %>">
                                            <span id="quantityError" class="error-text  text-danger"></span>
                                        </div>
                                    </div>
                                
                                    <!-- Price -->
                                    <div class="mb-4 row align-items-center">
                                        <label class="form-label-title col-sm-3 mb-0">Price</label>
                                        <div class="col-sm-9">
                                            <input class="form-control" type="text" name="price" placeholder="" value="<%= product.price %>">
                                            <span id="priceError" class="error-text  text-danger"></span>
                                        </div>
                                    </div>
                                
                                    <!-- Size Dropdown Field -->
                                    <div class="mb-4 row align-items-center">
                                        <label class="form-label-title col-sm-3 mb-0">Size</label>
                                        <div class="col-sm-9">
                                            <select class="form-control" name="size">
                                                <option value="small">Small</option>
                                                <option value="medium">Medium</option>
                                                <option value="large">Large</option>
                                                <option value="extra-large">Extra Large</option>
                                            </select>
                                        </div>
                                    </div>
                                
                                    <!-- Submit Button -->
                                    <div class="mb-4 row align-items-center">
                                        <div class="col-sm-9 offset-sm-3">
                                            <button type="submit" class="btn btn-primary">Submit</button>
                                        </div>
                                    </div>
                                </form>
                                
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- New Product Add End -->

    <!-- footer Start -->
    <div class="container-fluid">
        <footer class="footer">
            <div class="row">
                <div class="col-md-12 footer-copyright text-center">
                    <p class="mb-0">Copyright 2022 Â© Fastkart theme by pixelstrap</p>
                </div>
            </div>
        </footer>
    </div>
    <!-- footer En -->
</div>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>



<!-- Your HTML file -->

<script>
    function validateProductForm() {
        var productImage = document.querySelector('input[name="productImage"]').files;
        var productName = document.querySelector('input[name="productname"]').value.trim();
        var description = document.querySelector('input[name="description"]').value.trim();
        var category = document.querySelector('select[name="category"]').value;
        var quantity = document.querySelector('input[name="quantity"]').value.trim();
        var price = document.querySelector('input[name="price"]').value.trim();

        var productImageError = document.getElementById('productImageError');
        var productNameError = document.getElementById('productNameError');
        var descriptionError = document.getElementById('descriptionError');
        var categoryError = document.getElementById('categoryError');
        var quantityError = document.getElementById('quantityError');
        var priceError = document.getElementById('priceError');

        // Reset error messages
        productImageError.innerText = '';
        productNameError.innerText = '';
        descriptionError.innerText = '';
        categoryError.innerText = '';
        quantityError.innerText = '';
        priceError.innerText = '';

        // Validate Product Image
        if (productImage.length === 0) {
            productImageError.innerText = 'Please select at least one image.';
            return false;
        }

        // Validate each selected image's extension
        var allowedExtensions = /(\.jpg|\.jpeg|\.png|\.webp)$/i;

// Validate each selected image's extension
for (var i = 0; i < productImage.length; i++) {
    var fileName = productImage[i].name;
    var fileExtension = fileName.substring(fileName.lastIndexOf('.') + 1).toLowerCase();
    if (!allowedExtensions.test(fileExtension)) {
        productImageError.innerText = 'Invalid file type. Upload images with extensions (jpg, jpeg, png, or webp).';
        return false;
    }
}



        // Validate Product Name
        if (productName === '') {
            productNameError.innerText = 'Product Name cannot be empty.';
            return false;
        } 

        // Validate Product Description
        if (description === '') {
            descriptionError.innerText = 'Product Description cannot be empty.';
            return false;
        } else if (/\d/.test(description)) {
            descriptionError.innerText = 'Product Description cannot contain numbers.';
            return false;
        }

        // Validate Category
        if (category === '') {
            categoryError.innerText = 'Please select a category.';
            return false;
        }

        // Validate Quantity
        if (quantity === '' || isNaN(quantity) || parseInt(quantity) < 0) {
            quantityError.innerText = 'Quantity must be a non-negative number.';
            return false;
        }

        // Validate Price
        if (price === '' || isNaN(price) || parseInt(price) < 0) {
            priceError.innerText = 'Price must be a non-negative number.';
            return false;
        }

        // Form is valid
        return true;
    }
</script>

<script>


function removeImage(imageindex, productId) {
    fetch('/admin/removeImage', {
        method: 'POST',
        headers: { // Fix the typo here from 'Headers' to 'headers'
            'Content-Type': 'application/json' // Fix the typo here from 'content-type' to 'Content-Type'
        },
        body: JSON.stringify({ productId, imageindex })
    })
        .then(response => {
            if (response.ok) {
                // Image removed
                window.location.reload();
                console.log("Image removed successfully"); // Fix the typo here from 'lof' to 'log'
            } else {
                console.error("Failed to remove image");
            }
        })
        .catch(error => {
            console.error("Network error:" + error);
        });
}
</script>


<%- include('../adminpartials/footer')%>
